<html>
<head>
<title>CS3410 Spring 2014 Distributed Honeypot Lab</title>
<style type="text/css"> 
h3 { font-weight: bold; font-size: 14pt; }
table { border-collapse: collapse; }
table.indent { margin-left: 2em; }
caption { font-size: 80%; padding-bottom: 3px; }
tr { vertical-align: top; }
img { padding-top: 1em; padding-left: 1em; }
#code { font-family: monospace; }
#dark { background-color: grey; }
#instr-eg { border: 1px solid black; }
#instr-eg tr td { border: 1px solid black; padding: 3px 3em 3px 3px; }
#main-wrap { text-align: center; }
#main { width: 48em; margin-left: auto; margin-right: auto; text-align: left; }
#opcodes { width: 40em; }
#opcodes tr td { font-family: monospace; font-size: 80%; text-align: center; border: 1px solid black; white-space: nowrap; }
#heading { font-weight: bold; }
#heading:after { content: "."; }
</style>
</head>
<body>

<div id="main-wrap">

  <h1>Individual Lab -  Distributed Honeypot</h1>
  <h3>CS3410</h3>
  <h3>Due ...</h3>

  <div id="main">

    <!-- <p><b>Reminder: you must work alone for this lab.</b></p> -->

    <h2>Overview</h2>

    <p>In this lab you will be writing a program that reads packet summary data from the kernel and stores various statistics<!--, before sending them to an aggregation server-->.</p>

    <p>We have written a kernel module that captures incoming packets and extracts certain information from them, notably the source and destination ports, the source and destination IP addresses, the protocol, packet's djb2 hash, and and an updated number of dropped packets. You can see the structure of a packet summary in hp-ioctl.h. </p>
    <p> You will be storing the following statistics:</p>
      <ul>
        <li>The number of packets recieved from certain spammer addresses</li>
        <li>The number of packets sent to certain vulnerable ports</li>
        <li>The number of packets with one of the known "evil" hashes, marking them as dangerous</li>
        <li>The number of packets that have been dropped by the kernel</li>
        <li>The number of packets received by protocol</li>
        <li>The total number of packets recieved</li>
        <li>The total number of bytes received</li>
        <li>The average data rate</li>
      </ul>
    <p>In addition to data packets, your honeypot will occassionally recieve command packets, telling it to update its internal data structures in the specified manner. The description of each command is as follows: </p>
    <ul>
      <li>HONEYPOT_ADD_SPAMMER_BE: start tracking the specified spammer address</li>
      <li>HONEYPOT_DEL_SPAMMER_BE: stop tracking the specified spammer address</li>
      <li>HONEYPOT_ADD_VULNERABLE_BE: start tracking the specified vulnerable port</li>
      <li>HONEYPOT_DEL_VULNERABLE_BE: stop tracking the specified vulnerable port</li>
      <li>HONEYPOT_ADD_EVIL_BE: start tracking the specified evil hash</li>
      <li>HONEYPOT_DEL_EVIL_BE: stop tracking the specified evil hash</li>
      <li>HONEYPOT_PRINT_BE: print the current statistics stored </li>
    </ul>
    <p>You can figure out whether a packet is a command packet or a data packet by checking whether the cmd field of the hp_pkt is zero. Command packets have their own struct also defined in hp-ioctl.h.</p>
    <!--<p>You will also be writing an aggregation server for your Raspberry Pi to send its collected statistics too. We will be testing your aggregator with multiple clients, so make sure that you make it thread-safe!</p>-->

    <h2>What to submit</h2>

    <p>Submit your well-commented <tt>honeypi_read.c</tt>, <tt>net.c</tt> file and your <tt>honeypi_read</tt> binary.
    
   
    <h2>Overview of source files</h2>

    <p>All of the source files for the kernel module and packet generator are available in the course directory in the CSUG Lab. The top level
    directory contains the source code and a Makefile for compiling it. You should copy the files to your own
    directory to work on them:</p>
    <pre> $ cp -r /courses/cs3410/lab_honeypot ~/lab_honeypot
 $ cd ~/lab4</pre>
     <p>If you will be using the VM instead of CSUG then follow the instructions <a href="environment.html">here</a>.</p>
    
    <p> The <tt>hp-mod</tt> subdirectory contains the kernel module, and a Makefile for compiling it. An example honeypi_read program is in hp-user. It includes the code that reads from the kernel module (but nothing else)</p>

    <p>The most relevant files for you are:</p>
    <ul>
      <li><b>hp_ioctl.h</b> Contains the structs and constants associated with the command packets.</li>
      <li><b>hp-user/net.c</b> You write this file. It should contain all of your implementation that pertains to the network. </li>
      <li><b>hp-user/honeypi_read.c</b> This compiles into a executable. When this is correct is should send all the statistics about the packets the kernel module has received</li>
    </ul>

  <h2>Compiling the Code</h2
    
  <p>cd to the skeleton code directory</p>
  <pre>$ make</pre> 
  <p>On a different machine (or window)</p> 
    <pre>./agg_server.py</pre>
  
  <p>To install the kernel module :</p>
    <pre>cd hp-mod</pre>
    <pre>sudo insmod honeypi.ko</pre>

  <p>You need to find out what the major number of the module is, this can
  be done by running </p>
    <pre>cat /proc/devices</pre> 
  <p>and finding the entry for honeypi</p>

  <p>Once you have the major number. Run:</p>

    <pre>mknod /dev/honeypi c "major number"</pre>

  This creates the device file.

  <p>To run the local honeypot/p>
  <pre>cd hp-user</pre>
  <pre>sudo ./honeypi_read</pre>
  <h2>Help</h2>

  There are many resources available to help you with Linux network programming.
  <ul>
  <li>  <a href="http://beej.us/guide/bgnet/">Beej's Network Programming Guide</a> </ul>
  </ul>
  </div>
</div>
</body>
</html>


