<html>
<head>
<title>CS3410 Spring 2014 Distributed Honeypot Lab</title>
<style type="text/css"> 
h3 { font-weight: bold; font-size: 14pt; }
table { border-collapse: collapse; }
table.indent { margin-left: 2em; }
caption { font-size: 80%; padding-bottom: 3px; }
tr { vertical-align: top; }
img { padding-top: 1em; padding-left: 1em; }
#code { font-family: monospace; }
#dark { background-color: grey; }
#instr-eg { border: 1px solid black; }
#instr-eg tr td { border: 1px solid black; padding: 3px 3em 3px 3px; }
#main-wrap { text-align: center; }
#main { width: 48em; margin-left: auto; margin-right: auto; text-align: left; }
#opcodes { width: 40em; }
#opcodes tr td { font-family: monospace; font-size: 80%; text-align: center; border: 1px solid black; white-space: nowrap; }
#heading { font-weight: bold; }
#heading:after { content: "."; }
</style>
</head>
<body>

<div id="main-wrap">

  <h1>Individual Lab -  Distributed Honeypot</h1>
  <h3>CS3410</h3>
  <h3>Due ...</h3>

  <div id="main">

    <!-- <p><b>Reminder: you must work alone for this lab.</b></p> -->

    <h2>Overview</h2>

    <p>We give you the source code to the MIPS simulator that we have been using in previous assignments. Modify the
    simulator to simulate virtual memory, including a shared memory system call with copy-on-write semantics.</p>

    <p>The original simulator code did not implement virtual memory: for each load and store, the simulator simply used
    the address to index into a large array (allocated using <tt>malloc</tt>). We have modified the simulator in a few
    simple ways to get you started. In particular, we have implemented the simulation for the hardware part of the the
    virtual memory system, but not the software part:</p>
    <ul>
      <li>The simulator already supports physical memory using the existing code.</li>
      <li>The simulator now calls <tt>create_address_space()</tt> before loading a program to create a new set of page
      tables for the program.</li>
      <li>The simulator stores a (physical) pointer to these page tables in Register 4 on Coprocessor 0, i.e. c0r4,
      which is the standard MIPS <i>Context</i> register, also known as the <i>Page Table Base Register (PTBR)</i> on
      x86.</li>
      <li>The simulator now calls <tt>map_page()</tt> to create virtual mappings for the (virtual) memory segments of
      the program being loaded.</li>
      <li>For loads and stores, the simulator now traverses the page tables stored at c0r4 to translate virtual
      addresses to physical addresses before it accesses the existing physical memory.</li>
      <li>Simple stub code for the shared memory system call has been added so that the simulator calls
      <tt>map_shared_page()</tt> as needed to create copy-on-write virtual mappings. <i>Implementing copy-on-write mappings is optional.</i></li>
    </ul>

    <p>What is left for you to do is implement the simulation of what would normally be done by the operating
    system:</p>
    <ul>
      <li>Implement the <tt>create_address_space()</tt> function to create a virtual address space.</li>
      <li>Implement the <tt>map_page()</tt> function to create virtual mappings.</li>
      <li><i>(Optional)</i> Implement the <tt>map_shared_page()</tt> function call to support shared, copy-on-write virtual memory (do after map_page).</li>
      <li><i>(Optional)</i> Implement the <tt>pfault()</tt> function call to support process killing and shared, copy-on-write virtual memory (if map_shared_page is implemented).</li>
    </ul>

    <p>We provide a header file that describes precisely what each function should do.</p>

    <h2>What to submit</h2>

    <p>Submit your well-commented <tt>honeypi_read.c</tt>, <tt>net.c</tt> file and your <tt>honeypi_read</tt> binary.
    
   
    <h2>Overview of source files</h2>

    <p>All of the source files for the kernel module and packet generator are available in the course directory in the CSUG Lab. The top level
    directory contains the source code and a Makefile for compiling it. You should copy the files to your own
    directory to work on them:</p>
    <pre> $ cp -r /courses/cs3410/lab_honeypot ~/lab_honeypot
 $ cd ~/lab4</pre>
     <p>If you will be using the VM instead of CSUG then follow the instructions <a href="environment.html">here</a>.</p>
    
    <p> The <tt>hp-mod</tt> subdirectory contains the kernel module, and a Makefile for compiling it. An example honeypi_read program is in hp-user. It includes the code that reads from the kernel module (but nothing else)</p>

    <p>The most relevant files for you are:</p>
    <ul>
      <li><b>hp_ioctl.h</b> Contains the structs and constants associated with the command packets.</li>
      <li><b>hp-user/net.c</b> You write this file. It should contain all of your implementation that pertains to the network. </li>
      <li><b>hp-user/honeypi_read.c</b> This compiles into a executable. When this is correct is should send all the statistics about the packets the kernel module has received</li>
    </ul>

  <h2>Compiling the Code</h2
    
  <p>cd to the skeleton code directory</p>
  <pre>$ make</pre> 
  <p>On a different machine (or window)</p> 
    <pre>./agg_server.py</pre>
  
  <p>To install the kernel module :</p>
    <pre>cd hp-mod</pre>
    <pre>sudo insmod honeypi.ko</pre>

  <p>You need to find out what the major number of the module is, this can
  be done by running </p>
    <pre>cat /proc/devices</pre> 
  <p>and finding the entry for honeypi</p>

  <p>Once you have the major number. Run:</p>

    <pre>mknod /dev/honeypi c "major number"</pre>

  This creates the device file.

  <p>To run the local honeypot/p>
  <pre>cd hp-user</pre>
  <pre>sudo ./honeypi_read</pre>
  <h2>Help</h2>

  There are many resources available to help you with Linux network programming.
  <ul>
  <li>  <a href="http://beej.us/guide/bgnet/">Beej's Network Programming Guide</a> </ul>
  </ul>
  </div>
</div>
</body>
</html>


